# –û—Ç—á–µ—Ç –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É Backend –ø—Ä–æ–µ–∫—Ç–∞ ProMarkirui

## –î–∞—Ç–∞: 26 –¥–µ–∫–∞–±—Ä—è 2025
## –í–µ—Ç–∫–∞: refactor/modular-architecture
## –°—Ç–∞—Ç—É—Å: ‚úÖ –ë–∞–∑–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ config.py          # –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (87 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ utils.py           # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã (97 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ routes/            # –ú–æ–¥—É–ª—å–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã API
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth.py        # ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (192 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ admin.py       # üîú –ó–∞–≥–ª—É—à–∫–∞ (10 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ callbacks.py   # üîú –ó–∞–≥–ª—É—à–∫–∞ (9 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ clients.py     # üîú –ó–∞–≥–ª—É—à–∫–∞ (9 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ contracts.py   # üîú –ó–∞–≥–ª—É—à–∫–∞ (11 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ invoices.py    # üîú –ó–∞–≥–ª—É—à–∫–∞ (10 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ partners.py    # üîú –ó–∞–≥–ª—É—à–∫–∞ (11 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ public.py      # üîú –ó–∞–≥–ª—É—à–∫–∞ (15 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ quotes.py      # üîú –ó–∞–≥–ª—É—à–∫–∞ (10 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ stats.py       # üîú –ó–∞–≥–ª—É—à–∫–∞ (10 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ tnved.py       # üîú –ó–∞–≥–ª—É—à–∫–∞ (11 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ server.py          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (9585 —Å—Ç—Ä–æ–∫ -> –±—É–¥–µ—Ç —É–º–µ–Ω—å—à–µ–Ω)
```

### 2. ‚úÖ config.py - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–ß—Ç–æ –≤—ã–Ω–µ—Å–µ–Ω–æ:**
- EMAIL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (SMTP, credentials)
- TELEGRAM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (BOT_TOKEN, CHAT_ID)
- –ü—É—Ç–∏ –∫ —Ä–µ—Å—É—Ä—Å–∞–º (ASSETS_DIR, SIGNATURE_PATH, STAMP_PATH, —à—Ä–∏—Ñ—Ç—ã)
- EXECUTOR_INFO (–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –ò–ü –¢—É—Ä–±–∏–Ω)
- MANAGER_EMAILS, PROTECTED_ADMIN_EMAIL
- EMAIL_ACCOUNTS (–¥–ª—è –ø–æ—á—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞)
- RATE_LIMITING –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω—è—Ç—å –±–µ–∑ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–æ–¥—É
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è .env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)

### 3. ‚úÖ utils.py - –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã

**–§—É–Ω–∫—Ü–∏–∏:**
- `send_email_beget()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ SMTP
- `send_telegram_notification()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

### 4. ‚úÖ routes/auth.py - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- POST `/api/auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- POST `/api/auth/login` - –≤—Ö–æ–¥
- GET `/api/auth/me` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- GET `/api/auth/verify-email` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
- POST `/api/auth/resend-verification` - –ø–æ–≤—Ç–æ—Ä –ø–∏—Å—å–º–∞
- POST `/api/auth/forgot-password` - —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
- GET `/api/auth/verify-reset-token` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
- POST `/api/auth/reset-password` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Rate limiting –¥–ª—è forgot-password
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å email_service
- –í—Å–µ –º–æ–¥–µ–ª–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### 5. ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ –≤ server.py

```python
# Auth router
from routes.auth import router as auth_router
app.include_router(auth_router)
```

### 6. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω
- ‚úÖ –°–µ—Ä–≤–∏—Å —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç (health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç)
- ‚úÖ Auth —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ OpenAPI

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `routes/public.py`:
- `/api/check/*` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏
- `/api/import/*` - –∏–º–ø–æ—Ä—Ç
- `/api/equipment/*` - –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
- `/api/contact/*` - –∫–æ–Ω—Ç–∞–∫—Ç—ã
- `/api/training/*` - –æ–±—É—á–µ–Ω–∏–µ
- `/api/company/*` - –ø–æ–∏—Å–∫ –∫–æ–º–ø–∞–Ω–∏–π
- `/api/quote/create` - —Å–æ–∑–¥–∞–Ω–∏–µ –ö–ü
- `/api/services/*` - —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: TNVED –∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `routes/tnved.py`:
- `/api/tnved/*` - –¢–ù–í–≠–î –∫–æ–¥—ã
- `/api/marking/*` - —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏
- `/api/pilot/*` - –ø–∏–ª–æ—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: Callbacks
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `routes/callbacks.py`:
- `/api/callback/*` - –æ–±—Ä–∞—Ç–Ω—ã–µ –∑–≤–æ–Ω–∫–∏
- `/api/employee/callbacks/*` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- `/api/admin/callbacks/*` - –∞–¥–º–∏–Ω–∫–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –ö–ª–∏–µ–Ω—Ç—ã
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `routes/clients.py`:
- `/api/employee/clients/*` - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –î–æ–∫—É–º–µ–Ω—Ç—ã
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–æ—É—Ç–µ—Ä—ã:
- `routes/quotes.py` - –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- `routes/contracts.py` - –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- `routes/invoices.py` - —Å—á–µ—Ç–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 6: –ü–∞—Ä—Ç–Ω–µ—Ä—ã
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `routes/partners.py`:
- `/api/employee/partners/*`
- `/api/partner/*`
- `/api/ref/*`
- –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 7: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `routes/admin.py`:
- `/api/admin/*`
- `/api/superadmin/*`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë—ç–∫–∞–ø—ã
- ‚úÖ `server.py.before_refactor_20251226_103903` (544KB)
- ‚úÖ –ò—Å—Ö–æ–¥–Ω—ã–π –±—ç–∫–∞–ø –≤ `backups/backend_before_refactor_20251226_100047`

### Git
- –í–µ—Ç–∫–∞: `refactor/modular-architecture`
- –ò–∑–º–µ–Ω–µ–Ω—ã: `server.py`, `database.py`
- –î–æ–±–∞–≤–ª–µ–Ω—ã: `config.py`, `utils.py`, `routes/*`

### –°–µ—Ä–≤–∏—Å
- –ò–º—è: `promarkirui.service`
- –°—Ç–∞—Ç—É—Å: ‚úÖ Running
- –ü–æ—Ä—Ç: 8001
- –ë–∞–∑–∞: SQLite (promarkirui.db)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é

1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è:** –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ø–æ –æ–¥–Ω–æ–º—É –º–æ–¥—É–ª—é –∑–∞ —Ä–∞–∑
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–±–æ—Ç—É API
3. **–ë—ç–∫–∞–ø—ã:** –î–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –±–æ–ª—å—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
4. **–ò–º–ø–æ—Ä—Ç—ã:** –°–ª–µ–¥–∏—Ç—å –∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –û–±–Ω–æ–≤–ª—è—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

## –ú–µ—Ç—Ä–∏–∫–∏

- **–ë—ã–ª–æ:** server.py - 9581 —Å—Ç—Ä–æ–∫–∞ (–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª)
- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 14
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ –º–æ–¥—É–ª—è—Ö:** ~482 (config + utils + —Ä–æ—É—Ç–µ—Ä—ã)
- **Auth —Ä–æ—É—Ç–µ—Ä:** 192 —Å—Ç—Ä–æ–∫–∏ (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π)
- **–°–Ω–∏–∂–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏:** –î–∞ (–º–æ–¥—É–ª–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã)
- **–£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏:** –î–∞ (–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–ë–∞–∑–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç**

–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º.
routes/auth.py –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω.
–û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º.

**–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, —Å–µ—Ä–≤–∏—Å —Å—Ç–∞–±–∏–ª–µ–Ω.**
